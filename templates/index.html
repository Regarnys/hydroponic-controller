<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Hydroponic Data</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1 class="green">Hydroponic Data</h1>

  <h2>Raw Sensor Table</h2>
  <table border="1">
    <tr><th>Timestamp</th><th>Sensor</th><th>Value</th></tr>
    {% for row in sensor_data %}
      <tr>
        <td>{{ row[0] }}</td>  <!-- timestamp -->
        <td>{{ row[1] }}</td>  <!-- sensor_name -->
        <td>{{ row[2] }}</td>  <!-- value -->
      </tr>
    {% endfor %}
  </table>

  <h2>pH Over Time</h2>
  <canvas id="phChart" width="600" height="300"></canvas>

  <script>
    let sensorData = {{ sensor_data|tojson }};
    // Filter for pH
    let phData = sensorData.filter(r => r[1] === "pH");
    let labels = phData.map(r => r[0]);  // Timestamps
    let values = phData.map(r => parseFloat(r[2]));

    let ctx = document.getElementById("phChart").getContext('2d');
    let phChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'pH',
          data: values,
          borderColor: 'blue',
          backgroundColor: 'rgba(0,0,255,0.1)',
          fill: true,
          tension: 0.1
        }]
      },
      options: {
        scales: {
          y: {
            suggestedMin: 4,
            suggestedMax: 8
          }
        }
      }
    });
  </script>

  <p>
    <a href="{{ url_for('events') }}">Events</a> | 
    <a href="{{ url_for('manual_control') }}">Manual Pump Control</a> | 
    <a href="{{ url_for('config') }}">Config</a> | 
    <a href="{{ url_for('auto_dosing_test') }}">Auto Dosing Test</a>
  </p>
</body>
</html>

